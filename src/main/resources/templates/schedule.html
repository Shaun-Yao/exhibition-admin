<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="/webjars/github-com-novaeye-jquery-easyui-bower/1.5.0.1/jquery.min.js"></script>
    <script src="/webjars/github-com-novaeye-jquery-easyui-bower/1.5.0.1/jquery.easyui.min.js"></script>
    <link rel="stylesheet" href="/webjars/github-com-novaeye-jquery-easyui-bower/1.5.0.1/themes/default/easyui.css" />
    <link rel="stylesheet" href="/webjars/github-com-novaeye-jquery-easyui-bower/1.5.0.1/themes/icon.css" />

</head>
<body >


            <table id="dg" title="用户 CRUD 管理" class="easyui-datagrid" fitColumns="true" method="get"
                   singleSelect ="true" pagination="true" rownumbers="true" url="/bus-schedule/list" fit="true" toolbar="#tb">
                <thead>
                <tr>
                   <!-- <th field="cb" checkbox="true" align="center"></th>-->
                    <th field="id" hidden="true">ID</th>
                    <th field="name" width="100" align="center">班次名</th>
                    <th field="station" width="100" align="center">接送站点</th>
                    <th field="bus" width="100" formatter="formatBus" align="center">车牌号</th>
                    <th field="startTime" width="200" align="center">开始时间</th>
                    <th field="endTime" width="200" align="center">结束时间</th>
                </tr>
                </thead>
            </table>

            <!-- CRUD 菜单栏 -->
            <div id="tb">
                <!--plain="true"去掉边框-->
                <a href="javascript:openAddDialog()" class="easyui-linkbutton" iconCls="icon-add" plain="true">添加</a>
                <a href="javascript:openLinkModifyDialog()" class="easyui-linkbutton" iconCls="icon-edit" plain="true">修改</a>
                <a href="javascript:remove()" class="easyui-linkbutton" iconCls="icon-remove" plain="true">删除</a>
            </div>

            <!-- 修改框内容 -->
            <div id="dlg" class="easyui-dialog" style="width: 500px;height: 300px;padding: 10px 20px" closed="true" buttons="#dlg-buttons">
                <form id="form" action="/bus-schedule/add" method="post">
                    <table cellspacing="8px">
                        <tr>
                            <td>班次名称：</td>
                            <td>
                                <input type="text" id="name" name="name" class="easyui-validatebox" required="true" />
                            </td>
                        </tr>
                        <tr>
                            <td>接送站点：</td>
                            <td>
                                <select id="station" class="easyui-combobox" name="station" style="width:200px;">
                                    <option value="AIRPORT">潮汕揭阳机场</option>
                                    <option value="HIGH_SPEED_RAIL_STATION">潮汕高铁站</option>
                                    <option value="TRAIN_STATION">汕头火车站</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>车牌号：</td>
                            <td>
                                <input id="busId" class="easyui-combobox" name="busId" method="get"
                                       data-options="valueField:'id',textField:'busNum',url:'/bus/all'" required="true">
                            </td>
                        </tr>
                        <tr>
                            <td>开始时间：</td>
                            <td>
                                <input type="text" id="startTime" name="startTime" class="easyui-datetimebox" required="true" />
                            </td>
                        </tr>
                        <tr>
                            <td>结束时间：</td>
                            <td>
                                <input type="text" id="endTime" name="endTime" class="easyui-datetimebox" required="true" />
                            </td>
                        </tr>
                    </table>
                </form>
            </div>

            <!-- 修改对话框的 save、close 按钮 -->
            <div id="dlg-buttons">
                <a href="javascript:add()" class="easyui-linkbutton" iconCls="icon-ok">保存</a>
                <a href="javascript:closeLinkDialog()" class="easyui-linkbutton" iconCls="icon-cancel">关闭</a>
            </div>




</body>

<script th:inline="javascript">

    $(function(){
       /* $('#dg').datagrid({
            url:'/bus/list'
        });*/

    });

    function formatBus(value){
        return value.busNum;
    };
    
    function add() {
        $('#form').form('submit',{
            onSubmit:function(){

                return $(this).form('enableValidation').form('validate');
            },
            success: function(data){
                $('#dlg').dialog('close');
                $('#dg').datagrid('reload');
            }
        });
    }

    function remove()  {
        //console.log($('#dg').datagrid('getSelected').id);
        if($('#dg').datagrid('getSelected') == null) {
            return;
        }
        $.messager.confirm('Confirm', '确认删除?', function(r){
            if (r){
                $.ajax({
                    type: "POST",
                    url: "/bus-schedule/remove?id=" + $('#dg').datagrid('getSelected').id,
                    //async: false,
                    success: function(data){
                        $('#dg').datagrid('reload');
                    }
                });
            }
        });

    }
    
    function openAddDialog() {
        $('#dlg').dialog('open');
    }


</script>
</html>